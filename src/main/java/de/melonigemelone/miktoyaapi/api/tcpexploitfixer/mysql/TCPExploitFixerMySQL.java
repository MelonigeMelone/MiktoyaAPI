package de.melonigemelone.miktoyaapi.api.tcpexploitfixer.mysql;

import de.melonigemelone.miktoyaapi.repository.config.mysql.MySQLValues;
import de.melonigemelone.miktoyaapi.repository.lib.database.mysql.Callback;
import de.melonigemelone.miktoyaapi.repository.lib.database.mysql.MySQL;

public class TCPExploitFixerMySQL extends MySQL {

    //Stellt die Verbindung zur Datenbank her und erstellt die Tabellen fall sie nicht existieren
    public TCPExploitFixerMySQL() {
        super(MySQLValues.HOST.getValue(), MySQLValues.PORT.getValue(), MySQLValues.DATABASE.getValue(), MySQLValues.USER.getValue(), MySQLValues.PASSWORD.getValue());

        createTableIfNotExists("tcpexploitfixer_uuids",
                "  `id` int(11) unsigned NOT NULL AUTO_INCREMENT," +
                        "  `uuid` varchar(64) NOT NULL DEFAULT ''," +
                        "  PRIMARY KEY (`id`)"
        );

        createTableIfNotExists("tcpexploitfixer_connections",
                "  `id` int(11) unsigned NOT NULL AUTO_INCREMENT," +
                        "  `uuid` varchar(64) NOT NULL DEFAULT ''," +
                        "  PRIMARY KEY (`id`)"
        );

    }

    //Überprüft ob die UUID vom BungeeCord eingetragen wurde
    public void existsUUID(String uuid, Callback<Boolean> callback) {
        existsData("tcpexploitfixer_uuids",
                "uuid = '" + uuid + "'",
                callback);
    }

    //Fügt eine UUID zu den aktiven Verbindungen hinzu
    public void addConnection(String uuid) {
        existsConnection(uuid, result -> {
            if(!result) {
                insertData("tcpexploitfixer_connections",
                        "uuid",
                        "'" + uuid + "'");
            }
        });

    }

    //Löscht die UUID aus den Verbindungen zu unserem Server
    public void delConnection(String uuid) {
        deleteDataFromTable("tcpexploitfixer_connections",
                "uuid = '" + uuid + "'");
    }

    //Überpüft ob die UUID bereits auf einen unserer Server verbunden ist
    public void existsConnection(String uuid, Callback<Boolean> callback) {
        existsData("tcpexploitfixer_connections",
                "uuid = '" + uuid + "'",
                callback);
    }
}
